{"version":3,"file":"issueAttachments.mjs","sources":["../../../../src/version3/issueAttachments.ts"],"sourcesContent":["import type { Mime } from 'mime';\nimport mime from 'mime';\nimport type * as Models from './models';\nimport type * as Parameters from './parameters';\nimport type { Client } from '../clients';\nimport type { Callback } from '../callback';\nimport type { RequestConfig } from '../requestConfig';\n\nexport class IssueAttachments {\n  constructor(private client: Client) {}\n\n  /**\n   * Returns the contents of an attachment. A `Range` header can be set to define a range of bytes within the attachment\n   * to download. See the [HTTP Range header standard](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Range)\n   * for details.\n   *\n   * To return a thumbnail of the attachment, use [Get attachment\n   * thumbnail](#api-rest-api-3-attachment-thumbnail-id-get).\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:** For the\n   * issue containing the attachment:\n   *\n   * - _Browse projects_ [project permission](https://confluence.atlassian.com/x/yodKLg) for the project that the issue is\n   *   in.\n   * - If [issue-level security](https://confluence.atlassian.com/x/J4lKLg) is configured, issue-level security permission\n   *   to view the issue.\n   * - If attachments are added in private comments, the comment-level restriction will be applied.\n   */\n  async getAttachmentContent<T = Buffer>(\n    parameters: Parameters.GetAttachmentContent | string,\n    callback: Callback<T>,\n  ): Promise<void>;\n  /**\n   * Returns the contents of an attachment. A `Range` header can be set to define a range of bytes within the attachment\n   * to download. See the [HTTP Range header standard](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Range)\n   * for details.\n   *\n   * To return a thumbnail of the attachment, use [Get attachment\n   * thumbnail](#api-rest-api-3-attachment-thumbnail-id-get).\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:** For the\n   * issue containing the attachment:\n   *\n   * - _Browse projects_ [project permission](https://confluence.atlassian.com/x/yodKLg) for the project that the issue is\n   *   in.\n   * - If [issue-level security](https://confluence.atlassian.com/x/J4lKLg) is configured, issue-level security permission\n   *   to view the issue.\n   * - If attachments are added in private comments, the comment-level restriction will be applied.\n   */\n  async getAttachmentContent<T = Buffer>(\n    parameters: Parameters.GetAttachmentContent | string,\n    callback?: never,\n  ): Promise<T>;\n  async getAttachmentContent<T = Buffer>(\n    parameters: Parameters.GetAttachmentContent | string,\n    callback?: Callback<T>,\n  ): Promise<void | T> {\n    const id = typeof parameters === 'string' ? parameters : parameters.id;\n\n    const config: RequestConfig = {\n      url: `/rest/api/3/attachment/content/${id}`,\n      method: 'GET',\n      params: {\n        redirect: typeof parameters !== 'string' && parameters.redirect,\n      },\n      responseType: 'arraybuffer',\n    };\n\n    return this.client.sendRequest(config, callback);\n  }\n\n  /**\n   * Returns the attachment settings, that is, whether attachments are enabled and the maximum attachment size allowed.\n   *\n   * Note that there are also [project permissions](https://confluence.atlassian.com/x/yodKLg) that restrict whether\n   * users can create and delete attachments.\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:** None.\n   */\n  async getAttachmentMeta<T = Models.AttachmentSettings>(callback: Callback<T>): Promise<void>;\n  /**\n   * Returns the attachment settings, that is, whether attachments are enabled and the maximum attachment size allowed.\n   *\n   * Note that there are also [project permissions](https://confluence.atlassian.com/x/yodKLg) that restrict whether\n   * users can create and delete attachments.\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:** None.\n   */\n  async getAttachmentMeta<T = Models.AttachmentSettings>(callback?: never): Promise<T>;\n  async getAttachmentMeta<T = Models.AttachmentSettings>(callback?: Callback<T>): Promise<void | T> {\n    const config: RequestConfig = {\n      url: '/rest/api/3/attachment/meta',\n      method: 'GET',\n    };\n\n    return this.client.sendRequest(config, callback);\n  }\n\n  /**\n   * Returns the thumbnail of an attachment.\n   *\n   * To return the attachment contents, use [Get attachment content](#api-rest-api-3-attachment-content-id-get).\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:** For the\n   * issue containing the attachment:\n   *\n   * - _Browse projects_ [project permission](https://confluence.atlassian.com/x/yodKLg) for the project that the issue is\n   *   in.\n   * - If [issue-level security](https://confluence.atlassian.com/x/J4lKLg) is configured, issue-level security permission\n   *   to view the issue.\n   * - If attachments are added in private comments, the comment-level restriction will be applied.\n   */\n  async getAttachmentThumbnail<T = Buffer>(\n    parameters: Parameters.GetAttachmentThumbnail | string,\n    callback: Callback<T>,\n  ): Promise<void>;\n  /**\n   * Returns the thumbnail of an attachment.\n   *\n   * To return the attachment contents, use [Get attachment content](#api-rest-api-3-attachment-content-id-get).\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:** For the\n   * issue containing the attachment:\n   *\n   * - _Browse projects_ [project permission](https://confluence.atlassian.com/x/yodKLg) for the project that the issue is\n   *   in.\n   * - If [issue-level security](https://confluence.atlassian.com/x/J4lKLg) is configured, issue-level security permission\n   *   to view the issue.\n   * - If attachments are added in private comments, the comment-level restriction will be applied.\n   */\n  async getAttachmentThumbnail<T = Buffer>(\n    parameters: Parameters.GetAttachmentThumbnail | string,\n    callback?: never,\n  ): Promise<T>;\n  async getAttachmentThumbnail<T = Buffer>(\n    parameters: Parameters.GetAttachmentThumbnail | string,\n    callback?: Callback<T>,\n  ): Promise<void | T> {\n    const id = typeof parameters === 'string' ? parameters : parameters.id;\n\n    const config: RequestConfig = {\n      url: `/rest/api/3/attachment/thumbnail/${id}`,\n      method: 'GET',\n      params: {\n        redirect: typeof parameters !== 'string' && parameters.redirect,\n        fallbackToDefault: typeof parameters !== 'string' && parameters.fallbackToDefault,\n        width: typeof parameters !== 'string' && parameters.width,\n        height: typeof parameters !== 'string' && parameters.height,\n      },\n      responseType: 'arraybuffer',\n    };\n\n    return this.client.sendRequest(config, callback);\n  }\n\n  /**\n   * Returns the metadata for an attachment. Note that the attachment itself is not returned.\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:**\n   *\n   * - _Browse projects_ [project permission](https://confluence.atlassian.com/x/yodKLg) for the project that the issue is\n   *   in.\n   * - If [issue-level security](https://confluence.atlassian.com/x/J4lKLg) is configured, issue-level security permission\n   *   to view the issue.\n   * - If attachments are added in private comments, the comment-level restriction will be applied.\n   */\n  async getAttachment<T = Models.AttachmentMetadata>(\n    parameters: Parameters.GetAttachment | string,\n    callback: Callback<T>,\n  ): Promise<void>;\n  /**\n   * Returns the metadata for an attachment. Note that the attachment itself is not returned.\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:**\n   *\n   * - _Browse projects_ [project permission](https://confluence.atlassian.com/x/yodKLg) for the project that the issue is\n   *   in.\n   * - If [issue-level security](https://confluence.atlassian.com/x/J4lKLg) is configured, issue-level security permission\n   *   to view the issue.\n   * - If attachments are added in private comments, the comment-level restriction will be applied.\n   */\n  async getAttachment<T = Models.AttachmentMetadata>(\n    parameters: Parameters.GetAttachment | string,\n    callback?: never,\n  ): Promise<T>;\n  async getAttachment<T = Models.AttachmentMetadata>(\n    parameters: Parameters.GetAttachment | string,\n    callback?: Callback<T>,\n  ): Promise<void | T> {\n    const id = typeof parameters === 'string' ? parameters : parameters.id;\n\n    const config: RequestConfig = {\n      url: `/rest/api/3/attachment/${id}`,\n      method: 'GET',\n    };\n\n    return this.client.sendRequest(config, callback);\n  }\n\n  /**\n   * Deletes an attachment from an issue.\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:** For the\n   * project holding the issue containing the attachment:\n   *\n   * - _Delete own attachments_ [project permission](https://confluence.atlassian.com/x/yodKLg) to delete an attachment\n   *   created by the calling user.\n   * - _Delete all attachments_ [project permission](https://confluence.atlassian.com/x/yodKLg) to delete an attachment\n   *   created by any user.\n   */\n  async removeAttachment<T = void>(\n    parameters: Parameters.RemoveAttachment | string,\n    callback: Callback<T>,\n  ): Promise<void>;\n  /**\n   * Deletes an attachment from an issue.\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:** For the\n   * project holding the issue containing the attachment:\n   *\n   * - _Delete own attachments_ [project permission](https://confluence.atlassian.com/x/yodKLg) to delete an attachment\n   *   created by the calling user.\n   * - _Delete all attachments_ [project permission](https://confluence.atlassian.com/x/yodKLg) to delete an attachment\n   *   created by any user.\n   */\n  async removeAttachment<T = void>(parameters: Parameters.RemoveAttachment | string, callback?: never): Promise<T>;\n  async removeAttachment<T = void>(\n    parameters: Parameters.RemoveAttachment | string,\n    callback?: Callback<T>,\n  ): Promise<void | T> {\n    const id = typeof parameters === 'string' ? parameters : parameters.id;\n\n    const config: RequestConfig = {\n      url: `/rest/api/3/attachment/${id}`,\n      method: 'DELETE',\n    };\n\n    return this.client.sendRequest(config, callback);\n  }\n\n  /**\n   * Returns the metadata for the contents of an attachment, if it is an archive, and metadata for the attachment\n   * itself. For example, if the attachment is a ZIP archive, then information about the files in the archive is\n   * returned and metadata for the ZIP archive. Currently, only the ZIP archive format is supported.\n   *\n   * Use this operation to retrieve data that is presented to the user, as this operation returns the metadata for the\n   * attachment itself, such as the attachment's ID and name. Otherwise, use [ Get contents metadata for an expanded\n   * attachment](#api-rest-api-3-attachment-id-expand-raw-get), which only returns the metadata for the attachment's\n   * contents.\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:** For the\n   * issue containing the attachment:\n   *\n   * - _Browse projects_ [project permission](https://confluence.atlassian.com/x/yodKLg) for the project that the issue is\n   *   in.\n   * - If [issue-level security](https://confluence.atlassian.com/x/J4lKLg) is configured, issue-level security permission\n   *   to view the issue.\n   * - If attachments are added in private comments, the comment-level restriction will be applied.\n   */\n  async expandAttachmentForHumans<T = Models.AttachmentArchiveMetadataReadable>(\n    parameters: Parameters.ExpandAttachmentForHumans | string,\n    callback: Callback<T>,\n  ): Promise<void>;\n  /**\n   * Returns the metadata for the contents of an attachment, if it is an archive, and metadata for the attachment\n   * itself. For example, if the attachment is a ZIP archive, then information about the files in the archive is\n   * returned and metadata for the ZIP archive. Currently, only the ZIP archive format is supported.\n   *\n   * Use this operation to retrieve data that is presented to the user, as this operation returns the metadata for the\n   * attachment itself, such as the attachment's ID and name. Otherwise, use [ Get contents metadata for an expanded\n   * attachment](#api-rest-api-3-attachment-id-expand-raw-get), which only returns the metadata for the attachment's\n   * contents.\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:** For the\n   * issue containing the attachment:\n   *\n   * - _Browse projects_ [project permission](https://confluence.atlassian.com/x/yodKLg) for the project that the issue is\n   *   in.\n   * - If [issue-level security](https://confluence.atlassian.com/x/J4lKLg) is configured, issue-level security permission\n   *   to view the issue.\n   * - If attachments are added in private comments, the comment-level restriction will be applied.\n   */\n  async expandAttachmentForHumans<T = Models.AttachmentArchiveMetadataReadable>(\n    parameters: Parameters.ExpandAttachmentForHumans | string,\n    callback?: never,\n  ): Promise<T>;\n  async expandAttachmentForHumans<T = Models.AttachmentArchiveMetadataReadable>(\n    parameters: Parameters.ExpandAttachmentForHumans | string,\n    callback?: Callback<T>,\n  ): Promise<void | T> {\n    const id = typeof parameters === 'string' ? parameters : parameters.id;\n\n    const config: RequestConfig = {\n      url: `/rest/api/3/attachment/${id}/expand/human`,\n      method: 'GET',\n    };\n\n    return this.client.sendRequest(config, callback);\n  }\n\n  /**\n   * Returns the metadata for the contents of an attachment, if it is an archive. For example, if the attachment is a\n   * ZIP archive, then information about the files in the archive is returned. Currently, only the ZIP archive format is\n   * supported.\n   *\n   * Use this operation if you are processing the data without presenting it to the user, as this operation only returns\n   * the metadata for the contents of the attachment. Otherwise, to retrieve data to present to the user, use [ Get all\n   * metadata for an expanded attachment](#api-rest-api-3-attachment-id-expand-human-get) which also returns the\n   * metadata for the attachment itself, such as the attachment's ID and name.\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:** For the\n   * issue containing the attachment:\n   *\n   * - _Browse projects_ [project permission](https://confluence.atlassian.com/x/yodKLg) for the project that the issue is\n   *   in.\n   * - If [issue-level security](https://confluence.atlassian.com/x/J4lKLg) is configured, issue-level security permission\n   *   to view the issue.\n   * - If attachments are added in private comments, the comment-level restriction will be applied.\n   */\n  async expandAttachmentForMachines<T = Models.AttachmentArchiveImpl>(\n    parameters: Parameters.ExpandAttachmentForMachines | string,\n    callback: Callback<T>,\n  ): Promise<void>;\n  /**\n   * Returns the metadata for the contents of an attachment, if it is an archive. For example, if the attachment is a\n   * ZIP archive, then information about the files in the archive is returned. Currently, only the ZIP archive format is\n   * supported.\n   *\n   * Use this operation if you are processing the data without presenting it to the user, as this operation only returns\n   * the metadata for the contents of the attachment. Otherwise, to retrieve data to present to the user, use [ Get all\n   * metadata for an expanded attachment](#api-rest-api-3-attachment-id-expand-human-get) which also returns the\n   * metadata for the attachment itself, such as the attachment's ID and name.\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:** For the\n   * issue containing the attachment:\n   *\n   * - _Browse projects_ [project permission](https://confluence.atlassian.com/x/yodKLg) for the project that the issue is\n   *   in.\n   * - If [issue-level security](https://confluence.atlassian.com/x/J4lKLg) is configured, issue-level security permission\n   *   to view the issue.\n   * - If attachments are added in private comments, the comment-level restriction will be applied.\n   */\n  async expandAttachmentForMachines<T = Models.AttachmentArchiveImpl>(\n    parameters: Parameters.ExpandAttachmentForMachines | string,\n    callback?: never,\n  ): Promise<T>;\n  async expandAttachmentForMachines<T = Models.AttachmentArchiveImpl>(\n    parameters: Parameters.ExpandAttachmentForMachines | string,\n    callback?: Callback<T>,\n  ): Promise<void | T> {\n    const id = typeof parameters === 'string' ? parameters : parameters.id;\n\n    const config: RequestConfig = {\n      url: `/rest/api/3/attachment/${id}/expand/raw`,\n      method: 'GET',\n    };\n\n    return this.client.sendRequest(config, callback);\n  }\n\n  /**\n   * Adds one or more attachments to an issue. Attachments are posted as multipart/form-data ([RFC\n   * 1867](https://www.ietf.org/rfc/rfc1867.txt)).\n   *\n   * Note that:\n   *\n   * - The request must have a `X-Atlassian-Token: no-check` header, if not it is blocked. See [Special\n   *   headers](#special-request-headers) for more information.\n   * - The name of the multipart/form-data parameter that contains the attachments must be `file`.\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:**\n   *\n   * - _Browse Projects_ and _Create attachments_ [ project permission](https://confluence.atlassian.com/x/yodKLg) for the\n   *   project that the issue is in.\n   * - If [issue-level security](https://confluence.atlassian.com/x/J4lKLg) is configured, issue-level security permission\n   *   to view the issue.\n   */\n  async addAttachment<T = Models.Attachment[]>(\n    parameters: Parameters.AddAttachment,\n    callback: Callback<T>,\n  ): Promise<void>;\n  /**\n   * Adds one or more attachments to an issue. Attachments are posted as multipart/form-data ([RFC\n   * 1867](https://www.ietf.org/rfc/rfc1867.txt)).\n   *\n   * Note that:\n   *\n   * - The request must have a `X-Atlassian-Token: no-check` header, if not it is blocked. See [Special\n   *   headers](#special-request-headers) for more information.\n   * - The name of the multipart/form-data parameter that contains the attachments must be `file`.\n   *\n   * This operation can be accessed anonymously.\n   *\n   * **[Permissions](https://developer.atlassian.com/cloud/jira/platform/rest/v3/intro/#permissions) required:**\n   *\n   * - _Browse Projects_ and _Create attachments_ [ project permission](https://confluence.atlassian.com/x/yodKLg) for the\n   *   project that the issue is in.\n   * - If [issue-level security](https://confluence.atlassian.com/x/J4lKLg) is configured, issue-level security permission\n   *   to view the issue.\n   */\n  async addAttachment<T = Models.Attachment[]>(parameters: Parameters.AddAttachment, callback?: never): Promise<T>;\n  async addAttachment<T = Models.Attachment[]>(\n    parameters: Parameters.AddAttachment,\n    callback?: Callback<T>,\n  ): Promise<void | T> {\n    const formData = new FormData();\n    const attachments = Array.isArray(parameters.attachment) ? parameters.attachment : [parameters.attachment];\n\n    // eslint-disable-next-line @typescript-eslint/consistent-type-imports\n    let Readable: typeof import('stream').Readable | undefined;\n\n    if (typeof window === 'undefined') {\n      const { Readable: NodeReadable } = await import('stream');\n\n      Readable = NodeReadable;\n    }\n\n    for (const attachment of attachments) {\n      const file = await this._convertToFile(attachment, mime, Readable);\n\n      if (!(file instanceof File || file instanceof Blob)) {\n        throw new Error(`Unsupported file type for attachment: ${typeof file}`);\n      }\n\n      formData.append('file', file, attachment.filename);\n    }\n\n    const config: RequestConfig = {\n      url: `/rest/api/3/issue/${parameters.issueIdOrKey}/attachments`,\n      method: 'POST',\n      headers: {\n        'X-Atlassian-Token': 'no-check',\n        'Content-Type': 'multipart/form-data',\n      },\n      data: formData,\n      maxBodyLength: Infinity,\n      maxContentLength: Infinity,\n    };\n\n    return this.client.sendRequest(config, callback);\n  }\n\n  private async _convertToFile(\n    attachment: Parameters.Attachment,\n    mime: Mime,\n    // eslint-disable-next-line @typescript-eslint/consistent-type-imports\n    Readable?: typeof import('stream').Readable,\n  ): Promise<File | Blob> {\n    const mergeChunks = (chunks: Uint8Array[]) => {\n      const totalLength = chunks.reduce((sum, c) => sum + c.byteLength, 0);\n      const merged = new Uint8Array(totalLength);\n      let offset = 0;\n      for (const c of chunks) {\n        merged.set(c, offset);\n        offset += c.byteLength;\n      }\n\n      return merged;\n    };\n\n    const toUint8ArrayCopy = (input: ArrayBuffer | ArrayBufferView) => {\n      if (ArrayBuffer.isView(input)) {\n        const view = input as ArrayBufferView;\n        const src = new Uint8Array(view.buffer, view.byteOffset, view.byteLength);\n        const copy = new Uint8Array(src.byteLength);\n        copy.set(src);\n\n        return copy;\n      }\n      const buf = input as ArrayBuffer;\n      const src = new Uint8Array(buf);\n      const copy = new Uint8Array(src.byteLength);\n      copy.set(src);\n\n      return copy;\n    };\n\n    const mimeType = attachment.mimeType ?? (mime.getType(attachment.filename) || undefined);\n\n    if (attachment.file instanceof Blob || attachment.file instanceof File) {\n      return attachment.file;\n    }\n\n    if (typeof attachment.file === 'string') {\n      return new File([attachment.file], attachment.filename, { type: mimeType });\n    }\n\n    if (Readable && attachment.file instanceof Readable) {\n      return this._streamToBlob(attachment.file, attachment.filename, mimeType);\n    }\n\n    if (attachment.file instanceof ReadableStream) {\n      return this._streamToBlob(attachment.file, attachment.filename, mimeType);\n    }\n\n    if (ArrayBuffer.isView(attachment.file) || attachment.file instanceof ArrayBuffer) {\n      const chunk = toUint8ArrayCopy(attachment.file as ArrayBuffer | ArrayBufferView);\n      const merged = mergeChunks([chunk]);\n      const blob = new Blob([merged], { type: mimeType });\n\n      return new File([blob], attachment.filename, { type: mimeType });\n    }\n\n    throw new Error('Unsupported attachment file type.');\n  }\n\n  private async _streamToBlob(\n    // eslint-disable-next-line @typescript-eslint/consistent-type-imports\n    stream: import('stream').Readable | ReadableStream,\n    filename: string,\n    mimeType?: string,\n  ): Promise<File> {\n    const mergeChunks = (chunks: Uint8Array[]) => {\n      const totalLength = chunks.reduce((sum, c) => sum + c.byteLength, 0);\n      const merged = new Uint8Array(totalLength);\n      let offset = 0;\n      for (const c of chunks) {\n        merged.set(c, offset);\n        offset += c.byteLength;\n      }\n\n      return merged;\n    };\n\n    if (typeof window === 'undefined' && stream instanceof (await import('stream')).Readable) {\n      return new Promise((resolve, reject) => {\n        const chunks: Uint8Array[] = [];\n\n        stream.on('data', (chunk: Uint8Array | Buffer) => {\n          chunks.push(new Uint8Array(chunk));\n        });\n\n        stream.on('end', () => {\n          const merged = mergeChunks(chunks);\n          const blob = new Blob([merged], { type: mimeType });\n          resolve(new File([blob], filename, { type: mimeType }));\n        });\n\n        stream.on('error', reject);\n      });\n    }\n\n    if (stream instanceof ReadableStream) {\n      const reader = stream.getReader();\n      const chunks: Uint8Array[] = [];\n\n      let done = false;\n\n      while (!done) {\n        const { value, done: streamDone } = await reader.read();\n        if (value) chunks.push(new Uint8Array(value));\n        done = streamDone;\n      }\n\n      const merged = mergeChunks(chunks);\n      const blob = new Blob([merged], { type: mimeType });\n\n      return new File([blob], filename, { type: mimeType });\n    }\n\n    throw new Error('Unsupported stream type.');\n  }\n}\n"],"names":[],"mappings":"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"}