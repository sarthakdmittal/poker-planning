{"version":3,"file":"httpException.mjs","sources":["../../../../src/clients/httpException.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nexport const isUndefined = (obj: any): obj is undefined => typeof obj === 'undefined';\n\nexport const isNil = (val: any): val is null | undefined => isUndefined(val) || val === null;\n\nexport const isObject = (fn: any): fn is object => !isNil(fn) && typeof fn === 'object';\n\nexport const isString = (val: any): val is string => typeof val === 'string';\n\nexport const isNumber = (val: any): val is number => typeof val === 'number';\n\nexport interface HttpExceptionOptions {\n  /** Original cause of the error */\n  cause?: unknown;\n  description?: string;\n}\n\nexport const DEFAULT_EXCEPTION_STATUS = 500;\nexport const DEFAULT_EXCEPTION_MESSAGE = 'Something went wrong';\nexport const DEFAULT_EXCEPTION_CODE = 'INTERNAL_SERVER_ERROR';\nexport const DEFAULT_EXCEPTION_STATUS_TEXT = 'Internal server error';\n\n/** Defines the base HTTP exception, which is handled by the default Exceptions Handler. */\nexport class HttpException extends Error {\n  /**\n   * Instantiate a plain HTTP Exception.\n   *\n   * @example\n   *   throw new HttpException('message', HttpStatus.BAD_REQUEST);\n   *   throw new HttpException('custom message', HttpStatus.BAD_REQUEST, {\n   *     cause: new Error('Cause Error'),\n   *   });\n   *\n   * @param response String, object describing the error condition or the error cause.\n   * @param status HTTP response status code.\n   * @param options An object used to add an error cause. Configures error chaining support\n   * @usageNotes\n   * The constructor arguments define the response and the HTTP response status code.\n   * - The `response` argument (required) defines the JSON response body. alternatively, it can also be\n   *  an error object that is used to define an error [cause](https://nodejs.org/en/blog/release/v16.9.0/#error-cause).\n   * - The `status` argument (optional) defines the HTTP Status Code.\n   * - The `options` argument (optional) defines additional error options. Currently, it supports the `cause` attribute,\n   *  and can be used as an alternative way to specify the error cause: `const error = new HttpException('description', 400, { cause: new Error() });`\n   *\n   * By default, the JSON response body contains two properties:\n   * - `statusCode`: the Http Status Code.\n   * - `message`: a short description of the HTTP error by default; override this\n   * by supplying a string in the `response` parameter.\n   *\n   * The `status` argument is required, and should be a valid HTTP status code.\n   * Best practice is to use the `HttpStatus` enum imported from `nestjs/common`.\n   * @see https://nodejs.org/en/blog/release/v16.9.0/#error-cause\n   * @see https://github.com/microsoft/TypeScript/issues/45167\n   */\n  constructor(\n    public readonly response: string | Record<string, any>,\n    status?: number,\n    options?: HttpExceptionOptions,\n  ) {\n    super();\n\n    this.name = this.initName();\n    this.cause = this.initCause(response, options);\n    this.code = this.initCode(response);\n    this.message = this.initMessage(response);\n    this.status = this.initStatus(response, status);\n    this.statusText = this.initStatusText(response, this.status);\n  }\n\n  public readonly cause?: unknown;\n\n  public readonly code?: string;\n\n  public readonly status: number;\n\n  public readonly statusText?: string;\n\n  protected initMessage(response: string | Record<string, any>) {\n    if (isString(response)) {\n      return response;\n    }\n\n    if (isObject(response) && isString((response as Record<string, any>).message)) {\n      return (response as Record<string, any>).message;\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    if (this.constructor) {\n      return this.constructor.name.match(/[A-Z][a-z]+|[0-9]+/g)?.join(' ') ?? 'Error';\n    }\n\n    return DEFAULT_EXCEPTION_MESSAGE;\n  }\n\n  protected initCause(response: string | Record<string, any>, options?: HttpExceptionOptions): unknown {\n    if (options?.cause) {\n      return options.cause;\n    }\n\n    if (isObject(response) && isObject((response as Record<string, any>).cause)) {\n      return (response as Record<string, any>).cause;\n    }\n\n    return undefined;\n  }\n\n  protected initCode(response: string | Record<string, any>): string {\n    if (isObject(response) && isString((response as Record<string, any>).code)) {\n      return (response as Record<string, any>).code;\n    }\n\n    return DEFAULT_EXCEPTION_CODE;\n  }\n\n  protected initName(): string {\n    return this.constructor.name;\n  }\n\n  protected initStatus(response: string | Record<string, any>, status?: number): number {\n    if (status) {\n      return status;\n    }\n\n    if (isObject(response) && isNumber((response as Record<string, any>).status)) {\n      return (response as Record<string, any>).status;\n    }\n\n    if (isObject(response) && isNumber((response as Record<string, any>).statusCode)) {\n      return (response as Record<string, any>).statusCode;\n    }\n\n    return DEFAULT_EXCEPTION_STATUS;\n  }\n\n  protected initStatusText(response: string | Record<string, any>, status?: number): string | undefined {\n    if (isObject(response) && isString((response as Record<string, any>).statusText)) {\n      return (response as Record<string, any>).statusText;\n    }\n\n    return status ? undefined : DEFAULT_EXCEPTION_STATUS_TEXT;\n  }\n}\n"],"names":[],"mappings":"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"}